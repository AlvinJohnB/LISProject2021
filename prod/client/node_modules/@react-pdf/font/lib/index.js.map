{"version":3,"file":"index.js","sources":["../src/font.js","../src/standard.js","../src/index.js"],"sourcesContent":["/* eslint-disable max-classes-per-file */\n\nimport isUrl from 'is-url';\nimport fetch from 'cross-fetch';\nimport fontkit from '@react-pdf/fontkit';\n\nconst FONT_WEIGHTS = {\n  thin: 100,\n  hairline: 100,\n  ultralight: 200,\n  extralight: 200,\n  light: 300,\n  normal: 400,\n  medium: 500,\n  semibold: 600,\n  demibold: 600,\n  bold: 700,\n  ultrabold: 800,\n  extrabold: 800,\n  heavy: 900,\n  black: 900,\n};\n\nconst fetchFont = async (src, options) => {\n  const response = await fetch(src, options);\n\n  const buffer = await (response.buffer\n    ? response.buffer()\n    : response.arrayBuffer());\n\n  return buffer.constructor.name === 'Buffer' ? buffer : Buffer.from(buffer);\n};\n\nconst isDataUrl = dataUrl => {\n  const header = dataUrl.split(',')[0];\n  const hasDataPrefix = header.substring(0, 5) === 'data:';\n  const hasBase64Prefix = header.split(';')[1] === 'base64';\n\n  return hasDataPrefix && hasBase64Prefix;\n};\n\nconst resolveFontWeight = value => {\n  return typeof value === 'string' ? FONT_WEIGHTS[value] : value;\n};\n\nconst sortByFontWeight = (a, b) => a.fontWeight - b.fontWeight;\n\nclass FontSource {\n  constructor(src, fontFamily, fontStyle, fontWeight, options) {\n    this.src = src;\n    this.fontFamily = fontFamily;\n    this.fontStyle = fontStyle || 'normal';\n    this.fontWeight = fontWeight || 400;\n\n    this.data = null;\n    this.loading = false;\n    this.options = options;\n  }\n\n  async load() {\n    this.loading = true;\n\n    const { postscriptName } = this.options;\n\n    if (isDataUrl(this.src)) {\n      this.data = fontkit.create(\n        Buffer.from(this.src.split(',')[1], 'base64'),\n        postscriptName,\n      );\n    } else if (BROWSER || isUrl(this.src)) {\n      const { headers, body, method = 'GET' } = this.options;\n      const data = await fetchFont(this.src, { method, body, headers });\n      this.data = fontkit.create(data, postscriptName);\n    } else {\n      this.data = await new Promise((resolve, reject) =>\n        fontkit.open(this.src, postscriptName, (err, data) =>\n          err ? reject(err) : resolve(data),\n        ),\n      );\n    }\n\n    this.loading = false;\n  }\n}\n\nclass Font {\n  static create(family) {\n    return new Font(family);\n  }\n\n  constructor(family) {\n    this.family = family;\n    this.sources = [];\n  }\n\n  register({ src, fontWeight, fontStyle, ...options }) {\n    const numericFontWeight = resolveFontWeight(fontWeight);\n\n    this.sources.push(\n      new FontSource(src, this.family, fontStyle, numericFontWeight, options),\n    );\n  }\n\n  resolve(descriptor) {\n    const { fontWeight = 400, fontStyle = 'normal' } = descriptor;\n    const styleSources = this.sources.filter(s => s.fontStyle === fontStyle);\n\n    // Weight resolution. https://developer.mozilla.org/en-US/docs/Web/CSS/font-weight#Fallback_weights\n    const exactFit = styleSources.find(s => s.fontWeight === fontWeight);\n\n    if (exactFit) return exactFit;\n\n    let res;\n\n    if (fontWeight >= 400 && fontWeight <= 500) {\n      const leftOffset = styleSources.filter(s => s.fontWeight <= fontWeight);\n      const rightOffset = styleSources.filter(s => s.fontWeight > 500);\n      const fit = styleSources.filter(\n        s => s.fontWeight >= fontWeight && s.fontWeight < 500,\n      );\n\n      res = fit[0] || leftOffset[leftOffset.length - 1] || rightOffset[0];\n    }\n\n    const lt = styleSources\n      .filter(s => s.fontWeight < fontWeight)\n      .sort(sortByFontWeight);\n    const gt = styleSources\n      .filter(s => s.fontWeight > fontWeight)\n      .sort(sortByFontWeight);\n\n    if (fontWeight < 400) {\n      res = lt[lt.length - 1] || gt[0];\n    }\n\n    if (fontWeight > 500) {\n      res = gt[0] || lt[lt.length - 1];\n    }\n\n    if (!res) {\n      throw new Error(\n        `Could not resolve font for ${this.family}, fontWeight ${fontWeight}`,\n      );\n    }\n\n    return res;\n  }\n}\n\nexport default Font;\n","export default [\n  'Courier',\n  'Courier-Bold',\n  'Courier-Oblique',\n  'Helvetica',\n  'Helvetica-Bold',\n  'Helvetica-Oblique',\n  'Times-Roman',\n  'Times-Bold',\n  'Times-Italic',\n];\n","import font from './font';\nimport standard from './standard';\n\nfunction FontStore() {\n  let fonts = {};\n\n  let emojiSource = null;\n\n  let hyphenationCallback = null;\n\n  this.register = data => {\n    const { family } = data;\n\n    if (!fonts[family]) {\n      fonts[family] = font.create(family);\n    }\n\n    // Bulk loading\n    if (data.fonts) {\n      for (let i = 0; i < data.fonts.length; i += 1) {\n        fonts[family].register({ family, ...data.fonts[i] });\n      }\n    } else {\n      fonts[family].register(data);\n    }\n  };\n\n  this.registerEmojiSource = ({ url, format = 'png' }) => {\n    emojiSource = { url, format };\n  };\n\n  this.registerHyphenationCallback = callback => {\n    hyphenationCallback = callback;\n  };\n\n  this.getFont = descriptor => {\n    const { fontFamily } = descriptor;\n    const isStandard = standard.includes(fontFamily);\n\n    if (isStandard) return null;\n\n    if (!fonts[fontFamily]) {\n      throw new Error(\n        `Font family not registered: ${fontFamily}. Please register it calling Font.register() method.`,\n      );\n    }\n\n    return fonts[fontFamily].resolve(descriptor);\n  };\n\n  this.load = async descriptor => {\n    const { fontFamily } = descriptor;\n    const isStandard = standard.includes(fontFamily);\n\n    if (isStandard) return;\n\n    const f = this.getFont(descriptor);\n\n    // We cache the font to avoid fetching it many times\n    if (!f.data && !f.loading) {\n      await f.load();\n    }\n  };\n\n  this.reset = () => {\n    const keys = Object.keys(fonts);\n\n    for (let i = 0; i < keys.length; i += 1) {\n      const key = keys[i];\n      fonts[key].data = null;\n    }\n  };\n\n  this.clear = () => {\n    fonts = {};\n  };\n\n  this.getRegisteredFonts = () => fonts;\n\n  this.getEmojiSource = () => emojiSource;\n\n  this.getHyphenationCallback = () => hyphenationCallback;\n\n  this.getRegisteredFontFamilies = () => Object.keys(fonts);\n}\n\nexport default FontStore;\n"],"names":["FONT_WEIGHTS","thin","hairline","ultralight","extralight","light","normal","medium","semibold","demibold","bold","ultrabold","extrabold","heavy","black","fetchFont","src","options","response","fetch","buffer","arrayBuffer","constructor","name","Buffer","from","isDataUrl","dataUrl","header","split","hasDataPrefix","substring","hasBase64Prefix","resolveFontWeight","value","sortByFontWeight","a","b","fontWeight","FontSource","fontFamily","fontStyle","data","loading","load","postscriptName","fontkit","create","isUrl","headers","body","method","Promise","resolve","reject","open","err","Font","family","sources","register","numericFontWeight","push","descriptor","styleSources","filter","s","exactFit","find","res","leftOffset","rightOffset","fit","length","lt","sort","gt","Error","FontStore","fonts","emojiSource","hyphenationCallback","font","i","registerEmojiSource","url","format","registerHyphenationCallback","callback","getFont","isStandard","standard","includes","f","reset","keys","Object","key","clear","getRegisteredFonts","getEmojiSource","getHyphenationCallback","getRegisteredFontFamilies"],"mappings":"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"}