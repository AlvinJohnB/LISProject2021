import t from"zlib";export default(function(){function a(t){var a;for(this.data=t,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.text={};;){var e=this.readUInt32(),i="";for(a=0;a<4;a++)i+=String.fromCharCode(this.data[this.pos++]);switch(i){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"PLTE":this.palette=this.read(e);break;case"IDAT":for(a=0;a<e;a++)this.imgData.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:this.transparency.indexed=this.read(e);var s=255-this.transparency.indexed.length;if(s>0)for(a=0;a<s;a++)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(e)[0];break;case 2:this.transparency.rgb=this.read(e)}break;case"tEXt":var r=this.read(e),h=r.indexOf(0),o=String.fromCharCode.apply(String,r.slice(0,h));this.text[o]=String.fromCharCode.apply(String,r.slice(h+1));break;case"IEND":switch(this.colorType){case 0:case 3:case 4:this.colors=1;break;case 2:case 6:this.colors=3}this.hasAlphaChannel=[4,6].includes(this.colorType);var n=this.colors+(this.hasAlphaChannel?1:0);switch(this.pixelBitlength=this.bits*n,this.colors){case 1:this.colorSpace="DeviceGray";break;case 3:this.colorSpace="DeviceRGB"}return void(this.imgData=Buffer.from(this.imgData));default:this.pos+=e}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}a.decode=function(t,a){throw new Error("PNG.decode not available in browser build")},a.load=function(t){throw new Error("PNG.load not available in browser build")};var e=a.prototype;return e.read=function(t){for(var a=new Array(t),e=0;e<t;e++)a[e]=this.data[this.pos++];return a},e.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},e.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},e.decodePixels=function(a){var e=this;return t.inflate(this.imgData,function(t,i){if(t)throw t;var s=0,r=e.width,h=e.height,o=e.pixelBitlength/8,n=Buffer.alloc(r*h*o);function c(t,a,e,c,l){void 0===l&&(l=!1);for(var d=Math.ceil((r-t)/e),f=Math.ceil((h-a)/c),p=o*d,u=l?n:Buffer.alloc(p*f),v=0,b=0;v<f&&s<i.length;){var g,w,y,m,k;switch(i[s++]){case 0:for(y=0;y<p;y++)u[b++]=i[s++];break;case 1:for(y=0;y<p;y++)g=i[s++],m=y<o?0:u[b-o],u[b++]=(g+m)%256;break;case 2:for(y=0;y<p;y++)g=i[s++],w=(y-y%o)/o,k=v&&u[(v-1)*p+w*o+y%o],u[b++]=(k+g)%256;break;case 3:for(y=0;y<p;y++)g=i[s++],w=(y-y%o)/o,m=y<o?0:u[b-o],k=v&&u[(v-1)*p+w*o+y%o],u[b++]=(g+Math.floor((m+k)/2))%256;break;case 4:for(y=0;y<p;y++){var x,D;g=i[s++],w=(y-y%o)/o,m=y<o?0:u[b-o],0===v?k=D=0:(k=u[(v-1)*p+w*o+y%o],D=w&&u[(v-1)*p+(w-1)*o+y%o]);var I=m+k-D,M=Math.abs(I-m),P=Math.abs(I-k),C=Math.abs(I-D);x=M<=P&&M<=C?m:P<=C?k:D,u[b++]=(g+x)%256}break;default:throw new Error("Invalid filter algorithm: "+i[s-1])}if(!l){var B=((a+v*c)*r+t)*o,S=v*p;for(y=0;y<d;y++){for(var T=0;T<o;T++)n[B++]=u[S++];B+=(e-1)*o}}v++}}return 1===e.interlaceMethod?(c(0,0,8,8),c(4,0,8,8),c(0,4,4,8),c(2,0,4,4),c(0,2,2,4),c(1,0,2,2),c(0,1,1,2)):c(0,0,1,1,!0),a(n)})},e.decodePalette=function(){for(var t=this.palette,a=t.length,e=this.transparency.indexed||[],i=Buffer.alloc(e.length+a),s=0,r=0,h=0;h<a;h+=3){var o;i[s++]=t[h],i[s++]=t[h+1],i[s++]=t[h+2],i[s++]=null!=(o=e[r++])?o:255}return i},e.copyToImageData=function(t,a){var e,i,s=this.colors,r=null,h=this.hasAlphaChannel;this.palette.length&&(r=this._decodedPalette||(this._decodedPalette=this.decodePalette()),s=4,h=!0);var o=t.data||t,n=o.length,c=r||a,l=e=0;if(1===s)for(;l<n;){i=r?4*a[l/4]:e;var d=c[i++];o[l++]=d,o[l++]=d,o[l++]=d,o[l++]=h?c[i++]:255,e=i}else for(;l<n;)i=r?4*a[l/4]:e,o[l++]=c[i++],o[l++]=c[i++],o[l++]=c[i++],o[l++]=h?c[i++]:255,e=i},e.decode=function(t){var a=this,e=Buffer.alloc(this.width*this.height*4);return this.decodePixels(function(i){return a.copyToImageData(e,i),t(e)})},a}());
