{"version":3,"file":"index.js","sources":["../src/png.js","../src/jpeg.js","../src/cache.js","../src/resolve.js"],"sourcesContent":["import PNG from '@react-pdf/png-js';\n\nPNG.isValid = function(data) {\n  try {\n    return !!new PNG(data);\n  } catch (e) {\n    return false;\n  }\n};\n\nexport default PNG;\n","// Extracted from https://github.com/devongovett/pdfkit/blob/master/lib/image/jpeg.coffee\n\nconst MARKERS = [\n  0xffc0,\n  0xffc1,\n  0xffc2,\n  0xffc3,\n  0xffc5,\n  0xffc6,\n  0xffc7,\n  0xffc8,\n  0xffc9,\n  0xffca,\n  0xffcb,\n  0xffcc,\n  0xffcd,\n  0xffce,\n  0xffcf,\n];\n\nclass JPEG {\n  data = null;\n\n  width = null;\n\n  height = null;\n\n  constructor(data) {\n    this.data = data;\n\n    if (data.readUInt16BE(0) !== 0xffd8) {\n      throw new Error('SOI not found in JPEG');\n    }\n\n    let marker;\n    let pos = 2;\n\n    while (pos < data.length) {\n      marker = data.readUInt16BE(pos);\n      pos += 2;\n      if (MARKERS.includes(marker)) {\n        break;\n      }\n      pos += data.readUInt16BE(pos);\n    }\n\n    if (!MARKERS.includes(marker)) {\n      throw new Error('Invalid JPEG.');\n    }\n\n    pos += 3;\n    this.height = data.readUInt16BE(pos);\n\n    pos += 2;\n    this.width = data.readUInt16BE(pos);\n  }\n}\n\nJPEG.isValid = data => {\n  if (!data || !Buffer.isBuffer(data) || data.readUInt16BE(0) !== 0xffd8) {\n    return false;\n  }\n\n  let marker;\n  let pos = 2;\n\n  while (pos < data.length) {\n    marker = data.readUInt16BE(pos);\n    pos += 2;\n    if (MARKERS.includes(marker)) {\n      break;\n    }\n    pos += data.readUInt16BE(pos);\n  }\n\n  if (!MARKERS.includes(marker)) {\n    return false;\n  }\n\n  return true;\n};\n\nexport default JPEG;\n","const createCache = ({ limit = 100 } = {}) => {\n  let cache = {};\n  let keys = [];\n\n  return {\n    get: key => cache[key],\n    set: (key, value) => {\n      keys.push(key);\n      if (keys.length > limit) {\n        delete cache[keys.shift()];\n      }\n      cache[key] = value;\n    },\n    reset: () => {\n      cache = {};\n      keys = [];\n    },\n    length: () => keys.length,\n  };\n};\n\nexport default createCache;\n","import fs from 'fs';\nimport url from 'url';\nimport path from 'path';\nimport fetch from 'cross-fetch';\n\nimport PNG from './png';\nimport JPEG from './jpeg';\nimport createCache from './cache';\n\nexport const IMAGE_CACHE = createCache({ limit: 30 });\n\nconst getAbsoluteLocalPath = src => {\n  if (BROWSER) {\n    throw new Error('Cannot check local paths in client-side environment');\n  }\n\n  const { protocol, auth, host, port, hostname, path: pathname } = url.parse(\n    src,\n  );\n  const absolutePath = path.resolve(pathname);\n  if ((protocol && protocol !== 'file:') || auth || host || port || hostname) {\n    return undefined;\n  }\n  return absolutePath;\n};\n\nconst fetchLocalFile = src =>\n  new Promise((resolve, reject) => {\n    try {\n      if (BROWSER) {\n        reject(new Error('Cannot fetch local file in this environemnt'));\n        return;\n      }\n      const absolutePath = getAbsoluteLocalPath(src);\n      if (!absolutePath) {\n        reject(new Error(`Cannot fetch non-local path: ${src}`));\n        return;\n      }\n      fs.readFile(absolutePath, (err, data) =>\n        err ? reject(err) : resolve(data),\n      );\n    } catch (err) {\n      reject(err);\n    }\n  });\n\nconst fetchRemoteFile = async (uri, options) => {\n  const response = await fetch(uri, options);\n\n  const buffer = await (response.buffer\n    ? response.buffer()\n    : response.arrayBuffer());\n\n  return buffer.constructor.name === 'Buffer' ? buffer : Buffer.from(buffer);\n};\n\nconst isValidFormat = format => {\n  const lower = format.toLowerCase();\n  return lower === 'jpg' || lower === 'jpeg' || lower === 'png';\n};\n\nconst guessFormat = buffer => {\n  let format;\n\n  if (JPEG.isValid(buffer)) {\n    format = 'jpg';\n  } else if (PNG.isValid(buffer)) {\n    format = 'png';\n  }\n\n  return format;\n};\n\nconst isCompatibleBase64 = ({ uri }) =>\n  /^data:image\\/[a-zA-Z]*;base64,[^\"]*/g.test(uri);\n\nfunction getImage(body, extension) {\n  switch (extension.toLowerCase()) {\n    case 'jpg':\n    case 'jpeg':\n      return new JPEG(body);\n    case 'png':\n      return new PNG(body);\n    default:\n      return null;\n  }\n}\n\nconst resolveBase64Image = ({ uri }) => {\n  const match = /^data:image\\/([a-zA-Z]*);base64,([^\"]*)/g.exec(uri);\n  const format = match[1];\n  const data = match[2];\n\n  if (!isValidFormat(format)) {\n    throw new Error(`Base64 image invalid format: ${format}`);\n  }\n\n  return new Promise(resolve => {\n    return resolve(getImage(Buffer.from(data, 'base64'), format));\n  });\n};\n\nconst resolveImageFromData = src => {\n  if (src.data && src.format) {\n    return new Promise(resolve => resolve(getImage(src.data, src.format)));\n  }\n\n  throw new Error(`Invalid data given for local file: ${JSON.stringify(src)}`);\n};\n\nconst resolveBufferImage = buffer => {\n  const format = guessFormat(buffer);\n\n  if (format) {\n    return new Promise(resolve => resolve(getImage(buffer, format)));\n  }\n\n  return Promise.resolve();\n};\n\nconst getImageFormat = body => {\n  const isPng =\n    body[0] === 137 &&\n    body[1] === 80 &&\n    body[2] === 78 &&\n    body[3] === 71 &&\n    body[4] === 13 &&\n    body[5] === 10 &&\n    body[6] === 26 &&\n    body[7] === 10;\n\n  const isJpg = body[0] === 255 && body[1] === 216 && body[2] === 255;\n\n  let extension = '';\n  if (isPng) {\n    extension = 'png';\n  } else if (isJpg) {\n    extension = 'jpg';\n  } else {\n    throw new Error('Not valid image extension');\n  }\n\n  return extension;\n};\n\nconst resolveImageFromUrl = async src => {\n  const { uri, body, headers, method = 'GET' } = src;\n\n  const data =\n    !BROWSER && getAbsoluteLocalPath(uri)\n      ? await fetchLocalFile(uri)\n      : await fetchRemoteFile(uri, { body, headers, method });\n\n  const extension = getImageFormat(data);\n\n  return getImage(data, extension);\n};\n\nconst resolveImage = (src, { cache = true } = {}) => {\n  const cacheKey = src.data ? src.data.toString() : src.uri;\n\n  if (cache && IMAGE_CACHE.get(cacheKey)) {\n    return IMAGE_CACHE.get(cacheKey);\n  }\n\n  let image;\n  if (isCompatibleBase64(src)) {\n    image = resolveBase64Image(src);\n  } else if (Buffer.isBuffer(src)) {\n    image = resolveBufferImage(src);\n  } else if (typeof src === 'object' && src.data) {\n    image = resolveImageFromData(src);\n  } else {\n    image = resolveImageFromUrl(src);\n  }\n\n  if (!image) {\n    throw new Error('Cannot resolve image');\n  }\n\n  if (cache) {\n    IMAGE_CACHE.set(cacheKey, image);\n  }\n\n  return image;\n};\n\nexport default resolveImage;\n"],"names":["PNG","isValid","data","e","MARKERS","JPEG","constructor","width","height","readUInt16BE","Error","marker","pos","length","includes","Buffer","isBuffer","createCache","limit","cache","keys","get","key","set","value","push","shift","reset","IMAGE_CACHE","getAbsoluteLocalPath","src","protocol","auth","host","port","hostname","path","pathname","url","parse","absolutePath","resolve","undefined","fetchLocalFile","Promise","reject","BROWSER","fs","readFile","err","fetchRemoteFile","uri","options","response","fetch","buffer","arrayBuffer","name","from","isValidFormat","format","lower","toLowerCase","guessFormat","isCompatibleBase64","test","getImage","body","extension","resolveBase64Image","match","exec","resolveImageFromData","JSON","stringify","resolveBufferImage","getImageFormat","isPng","isJpg","resolveImageFromUrl","headers","method","resolveImage","cacheKey","toString","image"],"mappings":"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"}